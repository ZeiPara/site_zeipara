<!DOCTYPE html>
<html>
  <head>
    <title>シード値生成装置</title>
    <link rel="stylesheet" href="/styles.css"> </head>
  </head>
  <body>
    <input type="text" id="text">
    <input type="submit" onclick="create()" value="生成" />
    <div id="result" class="result"></div>
    <script src="/assets/js/load-header.js"></script>
    <script>
      function create() {
        const input = document.getElementById("text").value;
        let alltext = "";
        
        // 配列の要素を正確に取得するため for...of ループに修正
        for (const char of input) {
          alltext += String(char.codePointAt(0));
        }

        while (20 < alltext.length) {
          let splited = alltext.split("");
          
          // 3の倍数になるように0をパディング
          while (splited.length % 3 !== 0) {
            splited.push("0");
          }

          let allsum = 0;
          for (let i = 0; i < splited.length; i++) {
            allsum += parseInt(splited[i]);
          }

          // 末尾の1桁を取得する正しい方法
          const lastDigitOfSum = parseInt(String(allsum).slice(-1));

          let after_str = "";
          for (let i = 0; i < splited.length; i += 3) {
            const groupSum = parseInt(splited[i]) + parseInt(splited[i + 1]) + parseInt(splited[i + 2]) + lastDigitOfSum;
            after_str += String(groupSum);
          }
          alltext = after_str;
        }

        let result1 = document.getElementById("result");
        const result2 = alltext.split("");
        let sum = result2.reduce(function(sum, element){
          return sum + element;
        }, 0);
        alltext = parseInt(String(sum % 2 * 2 - 1) + String(alltext));
        result.innerHTML = `<p>${alltext}</p>`;
      }
    </script>
  </body>
</html>
