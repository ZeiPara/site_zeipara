<!DOCTYPE html>
<html>
  <head>
    <title>暗記</title>
  </head>
  <body>
    <form id="foom">
      <p>問題:</p><input id="question" type="text" required>
      <div id="answers-container">
        <p>回答1:</p><input type="text" class="kaitou" required>
        <p>回答2:</p><input type="text" class="kaitou" required>
      </div>
      <button type="button" id="addkaitou">回答を追加</button>
    </form>
    <input id="seikai" type="number">
    <button id="download-button">ダウンロード</button>
    <a href="#" id="link" style="display: none;"></a>
    <script>
      const form = document.getElementById("foom");
      const addAnswerBtn = document.getElementById("addkaitou");
      const answersContainer = document.getElementById("answers-container");
      const downloadButton = document.getElementById("download-button");
      const link = document.getElementById("link");
      
      let answerCount = 2; // 既存の回答数からカウントを開始します

      downloadButton.addEventListener("click", function() {
        let answerInputs = document.querySelectorAll(".kaitou");
        let data_list = [];
        answerInputs.forEach(input => {
          data_list.push(input.value); // push() を使用して配列に要素を追加
        });
        let mondai = document.getElementById("question").value;
        let seikai = document.getElementById("seikai").value;
        let data = {
          "question": mondai,
          "seikai": seikai,
          "answer": data_list
        };
        const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
        const url = URL.createObjectURL(blob);
        
        link.href = url;
        link.download = 'data.json';
        link.click();
        
        URL.revokeObjectURL(url); // オブジェクトURLを解放してメモリをクリーンアップ
      });
      
      addAnswerBtn.addEventListener("click", function() {
        answerCount++;
        const newAnswerContainer = document.createElement("div");
        newAnswerContainer.innerHTML = `
          <p>回答${answerCount}:</p>
          <input type="text" class="kaitou" required>
          <button type="button" class="kesukaitou">回答を削除</button>
        `;
        answersContainer.appendChild(newAnswerContainer);
      });

      // イベント委譲により、親要素で削除イベントを処理します
      answersContainer.addEventListener("click", function(event) {
        if (event.target.classList.contains("kesukaitou")) {
          answerCount -= 1;
          event.target.parentNode.remove();
        }
      });
    </script>
  </body>
</html>
